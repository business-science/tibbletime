<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Collapse an index vector so that all observations in an interval share the
same date — collapse_index • tibbletime</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Google analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76139189-1', 'auto');
  ga('send', 'pageview');

</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">tibbletime</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/TT-01-time-based-filtering.html">Time-based filtering</a>
    </li>
    <li>
      <a href="../articles/TT-02-changing-time-periods.html">Changing periodicity</a>
    </li>
    <li>
      <a href="../articles/TT-03-rollify-for-rolling-analysis.html">Rolling calculations in tibbletime</a>
    </li>
    <li>
      <a href="../articles/TT-04-use-with-dplyr.html">Using tibbletime with dplyr</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/business-science/tibbletime">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Collapse an index vector so that all observations in an interval share the
same date</h1>
    </div>

    
    <p>When <code>collapse_index()</code> is used, the index vector is altered
so that all dates that fall in a specified interval share a common date.
The most common use case for this is to then group on the collapsed index.</p>
    

    <pre class="usage"><span class='fu'>collapse_index</span>(<span class='no'>index</span>, <span class='kw'>period</span> <span class='kw'>=</span> <span class='st'>"yearly"</span>, <span class='kw'>start_date</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>side</span> <span class='kw'>=</span> <span class='st'>"end"</span>,
  <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>index</th>
      <td><p>An index vector.</p></td>
    </tr>
    <tr>
      <th>period</th>
      <td><p>A character specification used for time-based grouping. The
general format to use is <code>"frequency period"</code> where frequency is a number
like 1 or 2, and period is an interval like weekly or yearly. There must be
a space between the two.</p>
<p>Note that you can pass the specification in a flexible way:</p><ul>
<li><p>1 Year: <code>'1 year'</code> / <code>'1 Y'</code> / <code>'1 yearly'</code> / <code>'yearly'</code></p></li>
</ul>

<p>This shorthand is available for year, quarter, month, day, hour, minute,
and second periodicities. Note that "m" is the 1 letter specification used
for "month" and "M" is used for "minute". Otherwise case does not matter.</p></td>
    </tr>
    <tr>
      <th>start_date</th>
      <td><p>Optional argument used to specify the start date for the
first group. The default is to start at the closest period boundary
below the minimum date in the supplied index.</p></td>
    </tr>
    <tr>
      <th>side</th>
      <td><p>Whether to return the date at the beginning or the end of
the new period. By default, the "end" of the period.
Use "start" to change to the start of the period.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Not currently used.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Because this is often used for end of period summaries, the default is to
use <code>side = "end"</code>. Note that this is the opposite of <code><a href='as_period.html'>as_period()</a></code> where
the default is <code>side = "start"</code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># Basic functionality -------------------------------------------------------</span>

<span class='co'># Facebook stock prices</span>
<span class='fu'>data</span>(<span class='no'>FB</span>)
<span class='no'>FB</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='tbl_time.html'>as_tbl_time</a></span>(<span class='no'>FB</span>, <span class='no'>date</span>)

<span class='co'># Collapse to weekly dates</span>
<span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='http://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span>(<span class='no'>FB</span>, <span class='kw'>date</span> <span class='kw'>=</span> <span class='fu'>collapse_index</span>(<span class='no'>date</span>, <span class='st'>"weekly"</span>))</div><div class='output co'>#&gt; # A time tibble: 1,008 x 8
#&gt; # Index: date
#&gt;    symbol date        open  high   low close    volume adjusted
#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
#&gt;  1 FB     2013-01-04  27.4  28.2  27.4  28.0  69846400     28.0
#&gt;  2 FB     2013-01-04  27.9  28.5  27.6  27.8  63140600     27.8
#&gt;  3 FB     2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8
#&gt;  4 FB     2013-01-11  28.7  29.8  28.6  29.4  83781800     29.4
#&gt;  5 FB     2013-01-11  29.5  29.6  28.9  29.1  45871300     29.1
#&gt;  6 FB     2013-01-11  29.7  30.6  29.5  30.6 104787700     30.6
#&gt;  7 FB     2013-01-11  30.6  31.5  30.3  31.3  95316400     31.3
#&gt;  8 FB     2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7
#&gt;  9 FB     2013-01-18  32.1  32.2  30.6  31.0  98892800     31.0
#&gt; 10 FB     2013-01-18  30.6  31.7  29.9  30.1 173242600     30.1
#&gt; # ... with 998 more rows</div><div class='input'>
<span class='co'># A common workflow is to group on the new date column</span>
<span class='co'># to perform a time based summary</span>
<span class='no'>FB</span> <span class='kw'>%&gt;%</span>
  <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='http://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span>(<span class='kw'>date</span> <span class='kw'>=</span> <span class='fu'>collapse_index</span>(<span class='no'>date</span>, <span class='st'>"yearly"</span>)) <span class='kw'>%&gt;%</span>
  <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='http://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span>(<span class='no'>date</span>) <span class='kw'>%&gt;%</span>
  <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='http://dplyr.tidyverse.org/reference/summarise_all.html'>summarise_if</a></span>(<span class='no'>is.numeric</span>, <span class='no'>mean</span>)</div><div class='output co'>#&gt; # A time tibble: 4 x 7
#&gt; # Index: date
#&gt;   date        open  high   low close   volume adjusted
#&gt;   &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 2013-12-31  35.5  36.0  34.9  35.5 60091994     35.5
#&gt; 2 2014-12-31  68.8  69.6  67.8  68.8 47530552     68.8
#&gt; 3 2015-12-31  88.7  89.7  87.8  88.8 26955191     88.8
#&gt; 4 2016-12-30 117   118   116   117   25453798    117  </div><div class='input'>
<span class='co'># You can also assign the result to a separate column and use that</span>
<span class='co'># to nest on, allowing for 'period nests' that keep the</span>
<span class='co'># original dates in the nested tibbles.</span>
<span class='no'>FB</span> <span class='kw'>%&gt;%</span>
  <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='http://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span>(<span class='kw'>nest_date</span> <span class='kw'>=</span> <span class='fu'>collapse_index</span>(<span class='no'>date</span>, <span class='st'>"2 year"</span>)) <span class='kw'>%&gt;%</span>
  <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='http://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span>(<span class='no'>nest_date</span>) <span class='kw'>%&gt;%</span>
  <span class='kw pkg'>tidyr</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/tidyr/topics/nest'>nest</a></span>()</div><div class='output co'>#&gt; # A tibble: 2 x 2
#&gt;   nest_date  data              
#&gt;   &lt;date&gt;     &lt;list&gt;            
#&gt; 1 2014-12-31 &lt;tibble [504 × 8]&gt;
#&gt; 2 2016-12-30 &lt;tibble [504 × 8]&gt;</div><div class='input'>
<span class='co'># Grouped functionality -----------------------------------------------------</span>

<span class='fu'>data</span>(<span class='no'>FANG</span>)
<span class='no'>FANG</span> <span class='kw'>&lt;-</span> <span class='no'>FANG</span> <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='tbl_time.html'>as_tbl_time</a></span>(<span class='no'>date</span>) <span class='kw'>%&gt;%</span>
  <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='http://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span>(<span class='no'>symbol</span>)

<span class='co'># Collapse each group to monthly,</span>
<span class='co'># calculate monthly standard deviation for each column</span>
<span class='no'>FANG</span> <span class='kw'>%&gt;%</span>
  <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='http://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span>(<span class='kw'>date</span> <span class='kw'>=</span> <span class='fu'>collapse_index</span>(<span class='no'>date</span>, <span class='st'>"monthly"</span>)) <span class='kw'>%&gt;%</span>
  <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='http://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span>(<span class='no'>date</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>) <span class='kw'>%&gt;%</span>
  <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='fu'><a href='http://dplyr.tidyverse.org/reference/summarise_all.html'>summarise_all</a></span>(<span class='no'>sd</span>)</div><div class='output co'>#&gt; # A time tibble: 192 x 8
#&gt; # Index: date
#&gt; # Groups: symbol [?]
#&gt;    symbol date        open  high   low close  volume adjusted
#&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
#&gt;  1 AMZN   2013-01-31  7.11  7.21  5.63  6.31 2851878     6.31
#&gt;  2 AMZN   2013-02-28  3.21  3.38  3.26  3.82  863971     3.82
#&gt;  3 AMZN   2013-03-28  7.50  7.29  7.51  7.67  929111     7.67
#&gt;  4 AMZN   2013-04-30  6.32  6.22  6.15  6.69 2688623     6.69
#&gt;  5 AMZN   2013-05-31  5.40  5.60  6.44  5.72  781265     5.72
#&gt;  6 AMZN   2013-06-28  4.29  4.45  4.91  4.70  692542     4.70
#&gt;  7 AMZN   2013-07-31 10.1   9.68  9.09  9.04 1592530     9.04
#&gt;  8 AMZN   2013-08-30  7.67  7.08  6.98  7.65  443340     7.65
#&gt;  9 AMZN   2013-09-30  9.67  9.37  9.37  9.18  847804     9.18
#&gt; 10 AMZN   2013-10-31 20.6  21.4  20.7  21.4  2209026    21.4 
#&gt; # ... with 182 more rows</div><div class='input'>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Davis Vaughan, Matt Dancho.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
